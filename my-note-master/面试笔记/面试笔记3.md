# 从输入URL到页面加载的过程？

我的答案

1. dns寻址
2. 从服务器下载html等资源
3. 浏览器绘制DOM树,渲染css
4. js向后端发送网络请求
5. 加载结束

[文章](https://zhuanlan.zhihu.com/p/34453198?group_id=957277540147056640)

# 主干流程

## 浏览器接受到url到开启网络请求

### 解析url

+ `协议头` 例如http ftp
+ `host` 主机域名或者ip
+ `port` 端口
+ `path` 目录路径
+ `query` 查询参数
+ `#` hash模式,即是定位到某一个位置,例如a标签点击后跳转

## 开启网络线程到一个完整的http请求

### DNS寻址

如果是输入域名大概有以下流程

+ 如果浏览器有缓存,使用浏览器缓存,如果没有,使用本机缓存
+ 如果本机没有,则向远程DNS服务器查询

### tcp/ip请求

http本质是tcp/ip请求,会有三次握手建立连接,以及四次挥手断开连接

+ 三次握手

  ```
  client: 发送数据包到服务端等待服务端确定
  server: 收到数据包,确认后发送一个数据包
  client: 接受到服务器的确认包后,也向服务器发送一个确认包
  然后开始数据传输
  ```

+ 四次挥手

### tcp/ip的并发限制

浏览器会对**同一个域名**的并发tcp连接有限制(2-10个),而在http1.0中往往一个资源下载就需要对应一个tcp/ip请求

所以会有一些优化方案

1. 将静态资源放到不同的域名服务器
2. 设置keep-alive

### 五层因特网协议栈

从客户端发送http请求到服务端会经历一些过程

```
1. 应用层(http,dns) dns解析为ip并发送http请求
2. 传输层(tcp,udp) 建立tcp连接三次握手
3. 网络层(ip) ip寻址
4. 数据链路层(ppp) 封装成帧
5. 物理层 物理传输数据
```



## 从服务器收到请求到对应后台收到请求

### 负载均衡

一般大型项目都存在大量的并发量,一个服务器往往不够使用,用户的所有请求都会通过反向代理服务器,反向代理服务器会根据实际的调度算法,会分配不同的请求给对应集群,这里的反向代理服务器对于用户就相当于服务端,而反向代理服务器对于后端服务器反而相当于客户端

## 后台与前台的http交互

### http报文结构

前后端交互,http报文作为信息载体

报文结构包括

1. general

   ```
   请求web地址
   请求方式
   状态码
   ```

   

2. request header

3. response header

### cookie优化

因为cookie在同域名请求会默认携带上,如果当存储cookie的域名www.test.com 中有请求www.test.com的图片时候每个请求都会带上cookie,不同的二级域名不会带上cookie,所以尽量把图片和其他静态资源放在不同域名

### 长连接与短连接

+ 长连接,一个tcp连接上可以发送多个数据包,没有数据发送会维持一段时间再发送
+ 短连接, 有数据交互创建连接,没有则断开

http1.0 默认短连接

http1.1 默认长连接

## http缓存

### 强缓存与弱缓存

强缓存`200 from cache` 与协商缓存`304`

+ 强缓存, 浏览器如果判断本地缓存未过期,就直接使用,无需发起http请求
+ 协商缓存,浏览器会向服务端发送http请求,然后服务端告诉客户端,客户端使用本地缓存

## 浏览器收到数据的解析过程

1. 解析html,构建DOM树
2. 解析css,生成css规则树
3. 合并DOM和css规则,生成render树
4. 布局render树, 负责元素的尺寸和位置计算
5. 绘制render树



